<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css">
<link rel="stylesheet" th:href="@{/css/layout.css}">
<link rel="stylesheet" th:href="@{/css/component.css}">
<meta th:replace="fragments/Scripts :: scripts">
<title>電子会議室</title>
</head>
<body>
	<div class="cover"></div>
	<div th:replace="fragments/Sidenav :: sidenav"></div>
	<div class="main d-flex flex-column">
		<div th:replace="fragments/Header :: header"></div>
		<div class="container-fluid py-3" th:with="user=${#authentication.principal}">
			<!-- トピック新規登録 -->
			<div class="d-flex justify-content-end">
				<button class="btn btn-secondary btn-sm shadow-sm" data-bs-toggle="collapse"
						data-bs-target="#topicCreation">
						<span>トピック作成フォームを表示</span>
						<span class="d-none">トピック作成フォームを隠す</span>
				</button>
			</div>
			<div id="topicCreation" class="collapse mt-3">
				<form th:action="@{/comms/CreateTopic.do}" method="POST" class="border px-3 bg-light"
					th:object="${topicCreationForm}" autocomplete="off">
					<h5 class="my-3">トピック作成フォーム</h5>
					<div class="my-3">
						<label for="subject">トピックタイトル</label>
						<input type="text" class="form-control form-control-sm" style="width: 24rem;" 
							th:field="*{subject}" id="subject" />
						<div th:if="${#fields.hasErrors('subject')}">
							<span class="text-danger" th:errors="*{subject}"></span>
						</div>
					</div>
					<div class="my-3">
						<label for="primaryPost">投稿内容</label>
						<textarea id="primaryPost" th:field="*{primaryPost}" class="form-control form-control-sm" style="resize: none;"></textarea>
						<div th:if="${#fields.hasErrors('primaryPost')}">
							<span class="text-danger" th:errors="*{primaryPost}"></span>
						</div>
					</div>
					<div class="my-3 text-end">
						<button class="btn btn-success btn-sm shadow-sm">トピック作成</button>
					</div>
				</form>
			</div>
			<!-- トピック情報 -->
			<div id="topics">
				<div th:each="topic : ${topics}">
					<div th:id="${topic.topicNo}" class="mt-3 p-3 bg-light border">
						<h5 th:text="${topic.subject}" class="mb-3">トピックのタイトル</h5>
						<div class="d-flex border-bottom" th:each="post : ${topic.posts}">
							<div class="me-3">
								<img src="../static/img/anonymous.png" style="width: 64px;"
									th:src="${post.author.profileImage.encodedString()}"/>
							</div>
							<div class="flex-grow-1">
								<p class="fw-bold mb-2" th:text="${post.author.username}">投稿者の名前</p>
								<textarea class="form-control text-dark readonly p-0" readonly th:text="${post.postText}"></textarea>
								<div class="d-flex py-2 justify-content-end">
									<div class="d-flex align-items-baseline me-3">
										<a th:href="@{/meeting/HighRating.do}" class="me-2 text-dark fs-5"
											th:data-ts-post="${post.postNo}">
											<i class="bi bi-hand-thumbs-up"></i>
										</a>
										<span th:text="${post.goodRatings.size()}">13</span>
									</div>
									<div class="d-flex align-items-baseline me-3">
										<a th:href="@{/meeting/LowRating.do}" class="me-2 text-dark fs-5"
											th:data-ts-post="${post.postNo}">
											<i class="bi bi-hand-thumbs-down"></i>
										</a>
										<span th:text="${post.badRatings.size()}">2</span>
									</div>
									<div class="d-flex align-items-baseline">
										<span class="me-2 text-dark fs-5">
											<i class="bi bi-chat"></i>
										</span>
										<span th:text="${topic.posts.size() - 1}">8</span>
									</div>
								</div>
							</div>
						</div>
						<div class="d-flex mt-3">
							<div class="me-3">
								<img src="../static/img/anonymous.png" style="width: 64px;"
									th:src="${user.profileImage.encodedString()}"/>
							</div>
							<div class="flex-grow-1">
								<p class="fw-bold mb-2" th:text="${user.username}">ログインユーザーの名前</p>
								<textarea th:id="${topic.topicNo}" rows="2" class="form-control form-control-sm"></textarea>
								<div class="text-end mt-3">
									<button class="btn btn-success btn-sm shadow-sm">投稿</button>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>		
	</div>
	<div th:replace="fragments/Toast :: toast"></div>
</body>
</html>